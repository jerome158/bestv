name: to GZ
on:
  workflow_dispatch:

permissions:
  contents: write 
  
jobs:
  convert:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y unzip

      - name: Unzip test.zip
        run: |
          if [ -f test.zip ]; then
            unzip test.zip -d extracted_files
          else
            echo "test.zip not found"
            exit 1
          fi

      - name: Convert M3U to GZ
        run: |
          find extracted_files -type f -name "*.m3u" | while read file; do
            dir=$(dirname "$file")
            filename=$(basename "$file" .m3u)
            mkdir -p "tv/${dir#extracted_files/}"
            cat "$file" | gzip > "tv/${dir#extracted_files/}/${filename}.gz"
          done

      - name: Commit and push changes
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add tv/
          git commit -m "Convert M3U files to GZ format" || echo "No changes to commit"
          git push
